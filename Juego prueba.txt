#include<stdio.h>
#define N 15
#define M 3//NIVELES
int level=0;
int x, y;
int map[M][N][N]={

    {
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
    {0,3,1,1,1,0,1,1,1,0,0,0,0,0,0},
    {0,1,0,0,1,0,0,0,1,0,1,1,1,0,0},
    {0,1,1,1,1,0,1,1,1,0,1,0,1,0,0},
    {0,0,1,0,1,0,1,0,1,1,1,0,1,0,0},
    {0,1,1,0,1,0,1,0,1,0,0,0,1,1,0},
    {0,1,0,0,1,1,1,0,1,1,1,0,0,1,0},
    {0,1,1,0,1,1,0,0,0,0,1,0,0,0,0},
    {0,0,0,1,1,0,1,0,0,0,1,1,1,0,0},
    {0,1,0,1,1,1,0,0,0,0,0,0,1,0,0},
    {0,1,0,1,0,1,1,0,0,0,0,0,1,1,4},
    {0,0,1,1,0,1,1,1,0,1,0,1,0,1,0},
    {0,1,0,1,0,0,0,1,0,1,1,0,1,0,0},
    {0,1,0,1,1,1,1,1,1,1,1,0,1,1,0},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},

},
{
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
    {0,3,1,0,1,1,1,1,1,0,0,0,0,0,0},
    {0,1,0,0,1,0,0,0,1,1,1,1,1,0,0},
    {0,1,1,1,1,1,1,1,0,0,1,0,1,0,0},
    {0,0,0,0,1,0,1,0,1,1,1,0,1,0,0},
    {0,1,0,0,1,0,1,0,1,0,0,0,1,1,0},
    {0,1,0,0,1,1,1,0,1,1,1,0,0,1,0},
    {0,1,1,0,1,1,0,0,0,0,1,0,0,0,0},
    {0,0,0,1,1,0,1,0,0,0,1,0,1,0,0},
    {0,1,1,1,1,1,0,0,1,1,1,0,1,0,0},
    {0,1,0,1,0,1,1,0,1,0,0,0,1,1,0},
    {0,0,1,1,0,1,1,0,1,1,1,1,0,1,0},
    {0,1,0,1,0,0,0,1,0,0,1,0,1,0,0},
    {0,1,0,1,1,1,1,1,1,0,1,0,1,1,0},
    {0,0,0,0,0,0,0,0,0,0,4,0,0,0,0},
},
{
    {0,0,0,0,0,0,0,0,0,0,0,0,0,4,0},
    {0,3,1,1,0,1,0,0,0,1,1,1,0,1,0},
    {0,0,1,1,1,1,0,0,0,1,0,1,0,1,0},
    {0,0,1,1,0,1,0,0,0,1,0,1,1,1,0},
    {0,0,1,0,0,1,0,0,1,1,0,0,0,0,0},
    {0,0,1,1,0,1,0,0,1,1,0,1,0,0,0},
    {0,0,0,1,0,0,0,0,0,1,0,1,1,1,0},
    {0,1,1,1,1,1,1,1,1,1,0,0,0,1,0},
    {0,1,0,0,0,0,1,0,0,0,0,1,0,1,0},
    {0,1,1,0,0,0,0,0,1,0,0,1,0,1,0},
    {0,1,1,1,1,1,1,1,1,1,1,1,1,1,0},
    {0,0,1,0,0,1,0,0,0,0,0,1,0,0,0},
    {0,0,1,1,1,1,1,0,0,0,0,1,0,0,0},
    {0,0,1,0,0,1,0,0,0,0,0,1,1,1,0},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
},
};
void print();
void menu();
void posicion();
int move();
int Up();
int Down();
int Left();
int Right();

int main(void)

{
    int flag=0;
    menu();
    while(1)
    {
        flag= move();
        if(flag==1||flag==-1)
            return 0;
    }

    return 0;
}
void posicion()//POSICION DEL PERSONAJE
{
    int i=0, j=0;
    for(i=0;i<N;i++)
    {
        for(j=0;j<N; j++)
        {
        if(map[level][i][j]==3)
               {
                   x=i;
                   y=j;
                   break;
               }
        }
    }
}

int move()
{
    int flag = 0;
    while(1)
    {
        flag=0;
        posicion();
        print();
        switch(getch())//RECIBIR ORDENES
        {
            case 'w': flag=Up();
            break;
            case 'a': flag=Left();
            break;
            case 's': flag=Down();
            break;
            case 'd': flag=Right();
            break;
        }
        if(flag==1)
        {
            if(level==M-1)
            {
                printf("Finalizado el juego\n");
                return 1;//TERMINAR LA PARTIDA

            }


        else
        {
            system("pause");
            level++;//SIGUIENTE NIVEL
            return 0;

        }}
    }
}
int Up()
{
    if(x!=0)
    {
        if(map[level][x-1][y]==1)//SE PUEDE IR
        {
            map[level][x-1][y]=3;
            map[level][x][y]=1;

        }
        else if(map[level][x-1][y]==4)
        {
            return 1;
        }
    }
    return 0;
}
int Down()
{
    if(x!=N-1)
    {
        if(map[level][x+1][y]==1)//SE PUEDE IR
        {
            map[level][x+1][y]=3;
            map[level][x][y]=1;

        }
        else if(map[level][x+1][y]==4)
        {
            return 1;
        }
    }
    return 0;
}
int Right()
{
if(y!=N-1)
    {
        if(map[level][x][y+1]==1)//SE PUEDE IR
        {
            map[level][x][y+1]=3;
            map[level][x][y]=1;

        }
        else if(map[level][x][y+1]==4)
        {
            return 1;
        }
    }
    return 0;
}
int Left()
{
if(x!=0)
    {
        if(map[level][x][y-1]==1)//SE PUEDE IR
        {
            map[level][x][y-1]=3;
            map[level][x][y]=1;

        }
        else if(map[level][x][y-1]==4)
        {
            return 1;
        }
    }
    return 0;
}
void menu()
{
    char select [10];
    printf("los comandos es WASD, para salir pulsa 0\n");
    printf("Diga el nivel(1,2,3):");
    while(1) //ELEGIR LOS NIVELES
    {
         scanf("%c", select);

             if('1'==select[0])
             {
                 level=0;
                 break;
             }
             else if('2'==select[0])
             {
                 level=1;
                 break;
             }
             else if('3'==select[0])
             {
                 level=2;
                 break;
             }
             else
             {
                 printf("Error, intenta de nuevo");
             }

         }printf("%d\n",level);
    }


void print()
{
    int i=0, j=0;
    system("cls");
    for(i=0;i<N;i++)
    {
        for(j=0;j<N; j++)
        {
            if(map[level][i][j]==0)
                printf("#");//PARED
            else if(map[level][i][j]==3)
                printf("O");//PERSONAJE
            else if(map[level][i][j]==1)
                printf(" ");//ESPACIO
            else if(map[level][i][j]==4)
                printf("+");//SALIDA
        }
        printf("\n");
    }
}
